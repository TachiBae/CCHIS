<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard - CCHIS</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/style.css"> <!-- Keep for utilities if needed -->
    <link rel="stylesheet" href="css/mother-theme.css"> <!-- New Theme -->
</head>

<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand"><i class="fas fa-heartbeat"></i> CCHIS</div>
        </div>
        <div class="sidebar-menu">
            <a href="mother-dashboard.html" class="menu-item active">
                <i class="fas fa-home"></i> My Dashboard
            </a>
            <a href="my-profile.html" class="menu-item">
                <i class="fas fa-user"></i> My Profile
            </a>
            <a href="my-child.html" class="menu-item">
                <i class="fas fa-baby"></i> My Child
            </a>
            <a href="my-appointments.html" class="menu-item">
                <i class="fas fa-calendar-alt"></i> My Appointments
            </a>
            <a href="medical-history.html" class="menu-item">
                <i class="fas fa-file-medical"></i> Medical History
            </a>
            <a href="my-records.html" class="menu-item">
                <i class="fas fa-folder-open"></i> Medical Records
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-book-medical"></i> Health Resources
            </a>
            <a href="contact-worker.html" class="menu-item">
                <i class="fas fa-comment-medical"></i> Contact Health Worker
            </a>
            <a href="index.html" class="menu-item" style="margin-top: auto; color: var(--error-color);">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header Section -->
        <div class="dashboard-header">
            <div>
                <h1>Welcome back, Ella! üëã</h1>
                <p class="text-muted" style="font-size: 16px;">Good morning! Here's your health overview</p>
            </div>
            <div style="display: flex; gap: 12px; align-items: center;">
                <button id="downloadRecordsBtn" class="btn btn-outline" style="background: white;">
                    <i class="fas fa-file-download"></i> Download Records
                </button>
                <a href="index.html" class="btn btn-text">Logout</a>
            </div>
        </div>

        <!-- Quick Stats Cards (2x2 Grid) -->
        <div class="stats-grid">
            <!-- Next Appointment -->
            <div class="stat-card">
                <div class="stat-icon" style="background: #E3F2FD; color: #1565C0;">
                    <i class="fas fa-calendar-day"></i>
                </div>
                <div class="stat-title">Next Appt</div>
                <div class="stat-value" id="my-next-appt">Jan 10</div>
                <div class="text-small text-muted">10:00 AM with Dr. Santos</div>
            </div>

            <!-- Next Vaccine -->
            <div class="stat-card">
                <div class="stat-icon" style="background: #E8F5E9; color: #2E7D32;">
                    <i class="fas fa-syringe"></i>
                </div>
                <div class="stat-title">Next Vaccine</div>
                <div class="stat-value" id="my-next-vaccine">Pentavalent 1</div>
                <div class="text-small text-muted">Due in 2 weeks</div>
            </div>

            <!-- Status -->
            <div class="stat-card">
                <div class="stat-icon" style="background: #FFF3E0; color: #E65100;">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-title">Status</div>
                <div class="stat-value" id="my-pp-status">Safe</div>
                <div class="text-small text-muted">All vitals normal</div>
            </div>

            <!-- Notifications -->
            <div class="stat-card">
                <div class="stat-icon" style="background: #F3E5F5; color: #7B1FA2;">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="stat-title">Notifications</div>
                <div class="stat-value">3 New</div>
                <div class="text-small text-muted">Check updates</div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid-container">
            <!-- Left Column -->
            <div class="left-column">
                <!-- My Postpartum Journey -->
                <div class="card">
                    <h3>My Postpartum Journey</h3>
                    <div class="timeline" style="margin-top: 24px;">
                        <!-- Item 1 -->
                        <div class="timeline-item">
                            <div class="timeline-connector">
                                <div class="timeline-dot" style="background: var(--success-color); color: white;">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div class="timeline-line"></div>
                            </div>
                            <div class="timeline-content">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <strong>48 Hours</strong>
                                    <span class="text-muted text-small">Nov 16</span>
                                </div>
                                <span class="badge badge-safe">Completed</span>
                            </div>
                        </div>

                        <!-- Item 2 -->
                        <div class="timeline-item">
                            <div class="timeline-connector">
                                <div class="timeline-dot" style="background: var(--success-color); color: white;">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div class="timeline-line"></div>
                            </div>
                            <div class="timeline-content">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <strong>7 Days</strong>
                                    <span class="text-muted text-small">Nov 22</span>
                                </div>
                                <span class="badge badge-safe">Completed</span>
                            </div>
                        </div>

                        <!-- Item 3 -->
                        <div class="timeline-item">
                            <div class="timeline-connector">
                                <div class="timeline-dot" style="background: var(--warning-color); color: white;">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                            <div class="timeline-content">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <strong>6 Weeks</strong>
                                    <span class="text-muted text-small">Jan 10</span>
                                </div>
                                <span class="badge badge-warning">Upcoming</span>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                        <strong>Overall Status: </strong> <span class="badge badge-safe">Safe üü¢</span>
                    </div>
                </div>

                <!-- My Child's Progress -->
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div style="font-size: 24px;">üë∂</div>
                        <h3>Baby Martinez's Progress</h3>
                    </div>

                    <div class="grid-2-col" style="display: grid; gap: 16px; margin-bottom: 24px;">
                        <div>
                            <div class="text-muted text-small">Age</div>
                            <div style="font-weight: 600;">6 weeks</div>
                        </div>
                        <div>
                            <div class="text-muted text-small">Weight / Height</div>
                            <div style="font-weight: 600;">4.2 kg / 52 cm</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 24px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span class="text-small font-weight-bold">Vaccination Progress</span>
                            <span class="text-small text-muted">8/12 Vaccines</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 66%;"></div>
                        </div>
                    </div>

                    <div
                        style="background: var(--background-color); padding: 16px; border-radius: var(--radius-sm); margin-bottom: 24px;">
                        <div class="text-small text-muted" style="margin-bottom: 4px;">Next Milestone</div>
                        <div style="font-weight: 600;">Holds head steady</div>
                    </div>

                    <a href="my-child.html" class="btn btn-secondary" style="width: 100%;">View Growth Chart</a>
                </div>
            </div>

            <!-- Right Column -->
            <div class="right-column">
                <!-- Upcoming Appointments -->
                <div class="card">
                    <h3>üìÖ Upcoming Appointments</h3>

                    <div class="card"
                        style="background: var(--background-color); padding: 16px; margin-bottom: 16px; box-shadow: none;">
                        <div style="display: flex; gap: 12px;">
                            <div style="background: white; padding: 8px; border-radius: 8px; height: fit-content;">
                                üè•
                            </div>
                            <div>
                                <div style="font-weight: 600;">Postpartum Visit</div>
                                <div class="text-small text-muted">Jan 10, 2025 ‚Ä¢ 10:00 AM</div>
                                <div class="text-small text-muted">Dr. Santos</div>
                            </div>
                        </div>
                    </div>

                    <a href="my-appointments.html" class="btn btn-primary" style="width: 100%;">Request New
                        Appointment</a>
                </div>

                <!-- Notifications -->
                <div class="card">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3>üîî Notifications (3)</h3>
                        <a href="#" class="text-small" style="color: var(--primary-color);">View All</a>
                    </div>

                    <div class="notification-list" style="display: flex; flex-direction: column; gap: 0;">
                        <!-- Notifications will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/data.js"></script>
    <script src="js/script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="js/export-service.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const userId = localStorage.getItem('userId');
            if (!userId) return;

            // Export Handler
            const exportBtn = document.getElementById('downloadRecordsBtn');
            if (exportBtn) {
                exportBtn.addEventListener('click', function () {
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
                    this.disabled = true;

                    setTimeout(() => {
                        if (window.ExportService) {
                            window.ExportService.exportPatientToPDF(userId);
                        } else {
                            alert('Export service not loaded.');
                        }
                        this.innerHTML = originalText;
                        this.disabled = false;
                    }, 500);
                });
            }

            // Find mother data
            const mother = window.mockData.mothers.find(m => m.id === userId);
            if (!mother) return;

            // Update Welcome Message
            // Extract first name
            const firstName = mother.name.split(' ')[0];
            document.querySelector('.dashboard-header h1').textContent = `Welcome back, ${firstName}! üëã`;

            // Find child data
            // In mock data, mother has childId, or we search children array
            let child = null;
            if (mother.childId) {
                child = window.mockData.children.find(c => c.id === mother.childId);
            } else {
                // Fallback search by motherId
                child = window.mockData.children.find(c => c.motherId === userId);
            }

            if (child) {
                // Update Child Section Header
                const childHeader = document.querySelector('.card h3:nth-of-type(1)'); // "Baby Martinez's Progress"
                // Need to be specific selector
                const childSectionTitle = Array.from(document.querySelectorAll('h3')).find(el => el.textContent.includes('Progress'));
                if (childSectionTitle) {
                    childSectionTitle.textContent = `${child.name}'s Progress`;
                }

                // Update Child Stats
                const statsGrid = document.querySelector('.grid-2-col'); // Inside child card
                if (statsGrid) {
                    const weightHeightDiv = statsGrid.querySelectorAll('div > div[style*="font-weight: 600"]')[1];
                    if (weightHeightDiv) {
                        // Use birth weight/length if current not available, or mock current
                        // For now, let's use what's in child object or fallback
                        const weight = child.currentWeight || child.birthWeight || '4.2';
                        const height = child.currentHeight || child.birthLength || '52';
                        weightHeightDiv.textContent = `${weight} kg / ${height} cm`;
                    }
                }
            } else {
                // Hide child section or show "Register Child"
                // For now, just leave default or hide
            }
        });
    </script>
</body>

</html>